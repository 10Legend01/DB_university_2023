Спланируйте транзакции и выберите их уровни изоляции для базы данных Airline.

1. Для каждой хранимой процедуры из предыдущего домашнего задания выберите минимальный допустимый уровень изоляции транзакций (с обоснованием).
2. Реализуйте сценарий работы:
   1. Запрос списка свободных мест.
   2. Отображение списка свободных мест пользователю.
   3. Бронирование или покупка места, выбранного пользователем.

# 1. Уровни изоляции
Для всех заданий этого пункта в первой строке должно быть приведено объявление начала транзакции. Предшествующие строки должны содержать комментарии (--), обосновывающие выбор уровня изоляции транзакции.

### 1.1. FreeSeats
```sql
-- Косая запись: не страшно, т.к. данные не записываем.
-- Фантомная запись: не страшно, т.к. процедура не требует 
-- повторяемого чтения.
-- Неповторяемое чтение: не страшно, т.к. процедура не требует 
-- повторяемого чтения.
-- Грязное чтение: не страшно увидеть еще не внесенные в базу данных новые 
-- записи и данные для информирующего метода FreeSeats.
-- В случае вызова методов, изменяющие данные и использующие метод FreeSeats, 
-- будут учтена аномалия "грязное чтение" более высокими уровнями транзакциями,
-- т.к. RU не используется для записывающих методов.  
-- Итог: используем RU с режимом read only.
start transaction read only isolation level read uncommitted;
```

### 1.2. Reserve
```postgresql
-- Косая запись: не страшно, могут работать две параллельные транзакции на 
-- бронь двух разных мест.
-- Фантомная запись: очень страшно, ведь в методе используется upsert, и 
-- может перезаписаться бронь на кого-то другого.
-- Итог: Подойдет SN.
start transaction isolation level snapshot;
```

### 1.3. ExtendReservation
```sql
-- Косая запись: не страшно, т.к. работаем только с одной записью.
-- Фантомная запись: не страшно, т.к. нет повторных чтений из одного и того 
-- же места.
-- Неповторяемое чтение: страшно. Пример: успели отменить бронь и изменить на 
-- другого человека, пока работала транзакция.
-- Итог: Подойдет RR. 
start transaction isolation level repeatable read;
```

### 1.4. BuyFree
```sql
-- Косая запись: не страшно, могут работать две параллельные транзакции на 
-- покупку двух разных мест.
-- Фантомная запись: очень страшно, ведь в методе используется upsert, 
-- и может перезаписаться бронь на кого-то другого.
-- Итог: Подойдет SN.
start transaction isolation level snapshot;
```

### 1.5. BuyReserved
```sql
-- Косая запись: не страшно, т.к. работаем только с одной записью.
-- Фантомная запись: не страшно, т.к. нет повторных чтений из одного и 
-- того же места таблиц.
-- Неповторяемое чтение: страшно. Пример: успели отменить бронь и установить 
-- на другого пользователя, пока работала транзакция.
-- Итог: Подойдет RR. 
start transaction isolation level repeatable read;
```

### 1.6. FlightsStatistics
```sql
-- Полностью повторяет логику рассуждений "1.7 FlightStat", т.к. метод 
-- написан на его основе.
start transaction read only isolation level snapshot;
```

### 1.7. FlightStat
```sql
-- В методе используется два SELECT-a, очень сильно зависящие от 
-- неизменяемости данных.
-- Первый SELECT считает кол-во занятых мест, второй SELECT 
-- считает кол-во свободных мест.
-- Возможен случай, когда при обработанном первом SELECT-e изменились данные 
-- перед обработкой второго, поэтому второй SELECT будет несоответствовать 
-- первому. 
-- Итог: Подойдет SN.
-- Можно использовать режим "read only", т.к. данные не изменяются в этой 
-- транзакции.
start transaction read only isolation level snapshot;
```

### 1.8. CompressSeats
```sql
-- Косая запись: очень страшно. Пример: Мы поменяли одно из мест с брони на 
-- покупку, пока работал CompressSeats. В таком случае могут потеряться данные 
-- о покупке после завершения процедуры.
-- Итог: подойдет только S.
start transaction isolation level serializable;
```

____________________________

2. Реализуйте сценарий работы:
   1. Запрос списка свободных мест.
   2. Отображение списка свободных мест пользователю.
   3. Бронирование или покупка места, выбранного пользователем.

# 2. Сценарий

## 2.0. Общий план
Изложите общий план реализации, в том числе на каком этапе какие данные будут получены и как использованы
```  
1. Пользователь получает список свободных мест интересуемого рейса (:FlightId) на указанный рейс через FreeSeats.
2. Пользователь делает попытку купить (BuyFree) или заказать бронь (Reserve) желаемого места самолёта (:SeatNo) интересуемого рейса (:FlightId).
2.1. В случае покупки указывает рейс и место (:FlightId, :SeatNo).
2.2. В случае брони указывает личные данные, рейс и место (:UserId, :Password, :FlightId, :SeatNo).
```

### 2.1. Запрос списка свободных мест
Приведите соответствующие SQL-запросы
```sql
start transaction read only isolation level read uncommitted;
select FreeSeats(:FlightId);
commit;
```

## 2.2. Взаимодействие с пользователем
Укажите как будет релизовано взаимодействие с пользователем
```
0. Пользователь выполняет все действия на сайте. Все запросы отправляются с фронтенда на бэкенд сервера, который, в свою очередь, обращается к БД.
1. Пользователь может увидеть на сайте все рейсы и статистику по ним. 
2. Пользователь указывает рейс и получает информацию о свободных местах самолёта.
3. Пользователь указывает желаемое место для брони или покупки.
3.1. В случае брони дополнительно указывает логин и пароль (регистрируется и/или авторизуется).
```

### 2.3. Действия с местом
Приведите соответствующие SQL-запросы
```sql
-- В случае резервирования
start transaction read write isolation level snapshot;
select Reserve(:UserId, :Password, :FlightId, :SeatNo);
commit;

-- В случае покупки
start transaction read write isolation level snapshot;
select BuyFree(:FlightId, :SeatNo);
commit;
```